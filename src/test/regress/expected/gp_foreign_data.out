--
-- Test foreign-data wrapper and server management. Greenplum MPP specific
--
CREATE FOREIGN DATA WRAPPER dummy;
COMMENT ON FOREIGN DATA WRAPPER dummy IS 'useless';
-- CREATE FOREIGN SERVER
CREATE SERVER s0 FOREIGN DATA WRAPPER dummy OPTIONS (mpp_size '0'); --ERROR
ERROR:  "0" is not a valid mpp_size value
CREATE SERVER s0 FOREIGN DATA WRAPPER dummy;
CREATE SERVER s1 FOREIGN DATA WRAPPER dummy OPTIONS (mpp_execute 'all segments', mpp_size '6');
-- CREATE FOREIGN TABLE
CREATE FOREIGN TABLE ft2 (
	c1 int
) SERVER s0 OPTIONS (delimiter ',', mpp_execute 'a');           -- ERROR
ERROR:  "a" is not a valid mpp_execute value
CREATE FOREIGN TABLE ft2 (
	c1 int
) SERVER s0 OPTIONS (delimiter ',', mpp_execute 'any');
\d+ ft2
                            Foreign table "public.ft2"
 Column |  Type   | Modifiers | FDW Options | Storage | Stats target | Description 
--------+---------+-----------+-------------+---------+--------------+-------------
 c1     | integer |           |             | plain   |              | 
Server: s0
FDW Options: (delimiter ',', mpp_execute 'any')

CREATE FOREIGN TABLE ft3 (
	c1 int
) SERVER s0 OPTIONS (delimiter ',', mpp_execute 'master');
CREATE FOREIGN TABLE ft4 (
	c1 int
) SERVER s0 OPTIONS (delimiter ',', mpp_execute 'all segments');
CREATE FOREIGN TABLE ft5 (
	c1 int
) SERVER s1 OPTIONS (mpp_size '-1');           -- ERROR
ERROR:  "-1" is not a valid mpp_size value  (seg0 10.152.8.142:40000 pid=10904)
CREATE FOREIGN TABLE ft6 (
	c1 int
) SERVER s1 OPTIONS (mpp_size '8');
\d+ ft6
                            Foreign table "public.ft6"
 Column |  Type   | Modifiers | FDW Options | Storage | Stats target | Description 
--------+---------+-----------+-------------+---------+--------------+-------------
 c1     | integer |           |             | plain   |              | 
Server: s1
FDW Options: (mpp_size '8')

CREATE FOREIGN TABLE ft7 (
	c1 int
) SERVER s1;
\d+ ft7
                            Foreign table "public.ft7"
 Column |  Type   | Modifiers | FDW Options | Storage | Stats target | Description 
--------+---------+-----------+-------------+---------+--------------+-------------
 c1     | integer |           |             | plain   |              | 
Server: s1

